<!-- File: base_voter_analytics.html -->
<!-- Author: Sorathorn Thongpitukthavorn (plum@bu.edu), 10/29/2025 -->
<!-- Description: page to show list of all voters -->

{% extends 'base_voter_analytics.html' %}
{% load static %}

<h1>Showing all Voters</h1>

{% block content %}
<div class="container">

    <!-- Filter Form -->
    <form method="get" class="filter-form">
        <div class="row">
            <div class="col-md-3">
                <label for="party">Party:</label>
                <select name="party" class="form-control">
                    <option value="" selected disabled hidden>Choose</option>
                    {% for party in parties %}
                        <option value="{{ party }}" {% if request.GET.party == party %}selected{% endif %}>{{ party }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <label for="min_dob_year">Min Year of Birth:</label>
                <select name="min_dob_year" class="form-control">
                    <option value="" selected disabled hidden>Choose</option>
                    {% for year in date_of_births %}
                        <option value="{{ year }}" {% if request.GET.min_dob_year == year %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <label for="max_dob_year">Max Year of Birth:</label>
                <select name="max_dob_year" class="form-control">
                    <option value="" selected disabled hidden>Choose</option>
                    {% for year in date_of_births %}
                        <option value="{{ year }}" {% if request.GET.max_dob_year == year %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <label for="voter_score">Voter Score:</label>
                <select name="voter_score" class="form-control">
                    <option value="" selected disabled hidden>Choose</option>
                    {% for score in voter_scores %}
                        <option value="{{ score }}" {% if request.GET.voter_score == score %}selected{% endif %}>{{ score }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="col-md-3">
            <label>Previous Election Participation:</label><br>
            <div class="checkbox-group">
                {% for election in elections %}
                    <div class="form-check form-check-inline">
                        <input type="checkbox" name="{{ election }}" id="{{ election }}" class="form-check-input" {% if request.GET.election == 'on' %}checked{% endif %}>
                        <label class="form-check-label" for="{{ election }}">{{ election }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="?" class="btn btn-secondary">Cancel</a>
            </div>
        </div>
    </form>

    <!-- Navigation links for pagination -->
    <div class="row">
        {% if is_paginated %}
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li>
                    <span><a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Previous</a></span>
                </li>
            {% endif %}
                <li class="">
                    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.</span>
                </li>
            {% if page_obj.has_next %}
                <li>
                    <span><a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Next</a></span>
                </li>
            {% endif %}
        </ul>
        {% endif %}
    </div>

    <!-- Table of results -->
    <div class="row">
        <table class="table table-striped">
            <tr>
                <th>Name</th>
                <th>Address</th>
                <th>Date of Birth</th>
                <th>Party</th>
                <th>Voter Score</th>
            </tr>

            {% for v in voters %}
            <tr>
                <td><a href=" {% url 'voter_detail' v.pk %} ">{{ v.first_name }} {{ v.last_name }}</a></td>
                <td>
                    {{ v.street_number }}
                    {% if v.street_name %} {{ v.street_name }},{% endif %}
                    {% if v.apartment_number %} Apartment {{ v.apartment_number }},{% endif %}
                    {% if v.zip_code %}{{ v.zip_code }}{% endif %}
                </td>
                <td>{{ v.date_of_birth }}</td>
                <td>{{ v.party_affiliation }}</td>
                <td>{{ v.voter_score }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}
